{"componentChunkName":"component---gatsby-theme-maskzh-src-templates-blog-post-tsx","path":"/zh/浏览器打印最佳实践/","result":{"data":{"site":{"siteMetadata":{"title":"ZYC's Blog"}},"markdownRemark":{"html":"<p>Web 应用的打印总是有各种各样的问题，而且<code>window.print</code>不能局部打印页面中某一个部分。</p>\n<p>那如何实现局部呢？在尝试多种方式之后，我总结了比较简洁且无副作用的实践。</p>\n<p>在页面结构的任何层级下实现类似如下结构：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>print<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>print-page<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>页内容<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>print-page<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>页内容<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>与打印有关的 CSS：</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@media</span> print</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* 将非打印页的内容全部 display: none */</span>\n  <span class=\"token selector\">body > :not(.print-page)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/* 分页，最后一页不要分页，不然打印时会多出来一张空白页 */</span>\n  <span class=\"token selector\">body > .print-page:not(:last-child)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">page-break-after</span><span class=\"token punctuation\">:</span> always<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>实现打印的 JS：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">onPrint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> printNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'print'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>printNode<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> pageNodes <span class=\"token operator\">=</span> printNode<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.print-page'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>pageNodes<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n  pageNodes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 将打印页移动到 body 下</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 进行打印</span>\n  pageNodes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> printNode<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 将打印页移回原来的位置</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code>appendChild</code>方法对于已经存在于当前文档树中的元素，会将它从原先的位置<strong>移动</strong>到新的位置。注意是移动而不是复制。</p>","rawMarkdownBody":"\nWeb 应用的打印总是有各种各样的问题，而且`window.print`不能局部打印页面中某一个部分。\n\n那如何实现局部呢？在尝试多种方式之后，我总结了比较简洁且无副作用的实践。\n\n在页面结构的任何层级下实现类似如下结构：\n\n```html\n<div id=\"print\">\n  <div className=\"print-page\">页内容</div>\n  <div className=\"print-page\">页内容</div>\n</div>\n```\n\n与打印有关的 CSS：\n\n```css\n@media print {\n  /* 将非打印页的内容全部 display: none */\n  body > :not(.print-page) {\n    display: none;\n  }\n  /* 分页，最后一页不要分页，不然打印时会多出来一张空白页 */\n  body > .print-page:not(:last-child) {\n    page-break-after: always;\n  }\n}\n```\n\n实现打印的 JS：\n\n```typescript\nfunction onPrint() {\n  const printNode = document.getElementById('print');\n  if (!printNode) return;\n  const pageNodes = printNode.querySelectorAll('.print-page');\n  if (!pageNodes) return;\n\n  pageNodes.forEach((node) => document.body.appendChild(node)); // 将打印页移动到 body 下\n  window.print(); // 进行打印\n  pageNodes.forEach((node) => printNode.appendChild(node)); // 将打印页移回原来的位置\n}\n```\n\n`appendChild`方法对于已经存在于当前文档树中的元素，会将它从原先的位置**移动**到新的位置。注意是移动而不是复制。\n","timeToRead":1,"wordCount":{"paragraphs":6,"sentences":6,"words":15},"frontmatter":{"title":"浏览器打印最佳实践","tags":["Tech/HTML"],"created":"2021-03-11"}}},"pageContext":{"slug":"/浏览器打印最佳实践/","language":"zh","i18n":{"language":"zh","languages":["en","zh"],"defaultLanguage":"en","routed":true,"resources":{"zh":{"translation":{"home":"首页","not found":"找不到该页面","create date":"创建日期","search articles":"搜索","articles":"文章列表"}}},"originalPath":"/浏览器打印最佳实践/","path":"zh/浏览器打印最佳实践/"}}},"staticQueryHashes":["1985809839","1985809839","63159454"]}