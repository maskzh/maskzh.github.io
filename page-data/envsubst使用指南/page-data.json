{"componentChunkName":"component---gatsby-theme-maskzh-src-templates-blog-post-tsx","path":"/envsubst使用指南/","result":{"data":{"site":{"siteMetadata":{"title":"ZYC's Blog"}},"markdownRemark":{"html":"<p>一个小程序 <code>envsubst</code>，可以简洁地将环境变量注入到文件中。</p>\n<p>举个例子：我想把 CI 的 <code>BUILD_NUMBER</code> 注入到 <code>k8s</code> 的部署文件 <code>deployment.yaml</code> 中。</p>\n<p>文件本身是不支持动态变量的，所有的东西都是写死的。想要注入变量，那可以试试 <code>envsubst</code>。</p>\n<p>在 <code>deployment.yaml</code> 中通过 <code>${VAR}</code> 来注入变量。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 截取部分的配置文件\nenv:\n  - name: DRONE_BUILD_NUMBER\n    value: '${DRONE_BUILD_NUMBER}'</code></pre></div>\n<p>然后通过 <code>envsubst</code>，就可以将变量注入文件中。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DRONE_BUILD_NUMBER</span><span class=\"token operator\">=</span><span class=\"token variable\">${DRONE_BUILD_NUMBER}</span>\nenvsubst <span class=\"token operator\">&lt;</span> deployment.yaml <span class=\"token operator\">|</span> kubectl apply <span class=\"token parameter variable\">-f</span> -</code></pre></div>\n<p><code>envsubst</code> 使用非常简单，而且 Linux 系统中通常也自带这个小程序，不需要额外安装。</p>\n<p>参考：</p>\n<ul>\n<li><a href=\"https://www.gnu.org/software/gettext/manual/html_node/envsubst-Invocation.html\">Invoking the envsubst program</a></li>\n</ul>","rawMarkdownBody":"\n一个小程序 `envsubst`，可以简洁地将环境变量注入到文件中。\n\n举个例子：我想把 CI 的 `BUILD_NUMBER` 注入到 `k8s` 的部署文件 `deployment.yaml` 中。\n\n文件本身是不支持动态变量的，所有的东西都是写死的。想要注入变量，那可以试试 `envsubst`。\n\n在 `deployment.yaml` 中通过 `${VAR}` 来注入变量。\n\n```\n# 截取部分的配置文件\nenv:\n  - name: DRONE_BUILD_NUMBER\n    value: '${DRONE_BUILD_NUMBER}'\n```\n\n然后通过 `envsubst`，就可以将变量注入文件中。\n\n```bash\nexport DRONE_BUILD_NUMBER=${DRONE_BUILD_NUMBER}\nenvsubst < deployment.yaml | kubectl apply -f -\n```\n\n`envsubst` 使用非常简单，而且 Linux 系统中通常也自带这个小程序，不需要额外安装。\n\n参考：\n\n- [Invoking the envsubst program](https://www.gnu.org/software/gettext/manual/html_node/envsubst-Invocation.html)\n","timeToRead":1,"wordCount":{"paragraphs":8,"sentences":8,"words":28},"frontmatter":{"title":"envsubst 使用指南","tags":["Tech/DevOps"],"created":"2021-01-25"}}},"pageContext":{"slug":"/envsubst使用指南/","language":"en","i18n":{"language":"en","languages":["en","zh"],"defaultLanguage":"en","routed":false,"resources":{"en":{"translation":{"home":"Home","not found":"Not found","create date":"CREATE DATE","search articles":"Search","articles":"Articles"}}},"originalPath":"/envsubst使用指南/","path":"/envsubst使用指南/"}}},"staticQueryHashes":["1985809839","1985809839","63159454"]}